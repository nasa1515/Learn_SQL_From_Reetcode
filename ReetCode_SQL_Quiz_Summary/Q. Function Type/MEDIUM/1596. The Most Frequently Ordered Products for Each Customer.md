## [1596. The Most Frequently Ordered Products for Each Customer]

### Table: Customers


| Column Name   | Type    |
|---------------|---------|
| customer_id   | int     |
| name          | varchar |

customer_id is the column with unique values for this table.  
This table contains information about the customers.  
 

### Table: Orders


| Column Name   | Type    |
|---------------|---------|
| order_id      | int     |
| order_date    | date    |
| customer_id   | int     |
| product_id    | int     |

order_id is the column with unique values for this table.  
This table contains information about the orders made by customer_id.  
No customer will order the same product more than once in a single day.  
 
### Table: Products


| Column Name   | Type    |
|---------------|---------|
| product_id    | int     |
| product_name  | varchar |
| price         | int     |

product_id is the column with unique values for this table.  
This table contains information about the products.  
 
## Problem 

Write a solution to find the most frequently ordered product(s) for each customer.  

The result table should have the product_id and product_name for each customer_id who ordered at least one order.  

Return the result table in any order.  

The result format is in the following example.  


## Example 1:

### Input: 

Customers table:


| customer_id | name  |
|-------------|-------|
| 1           | Alice |
| 2           | Bob   |
| 3           | Tom   |
| 4           | Jerry |
| 5           | John  |

Orders table:

| order_id | order_date | customer_id | product_id |
|----------|------------|-------------|------------|
| 1        | 2020-07-31 | 1           | 1          |
| 2        | 2020-07-30 | 2           | 2          |
| 3        | 2020-08-29 | 3           | 3          |
| 4        | 2020-07-29 | 4           | 1          |
| 5        | 2020-06-10 | 1           | 2          |
| 6        | 2020-08-01 | 2           | 1          |
| 7        | 2020-08-01 | 3           | 3          |
| 8        | 2020-08-03 | 1           | 2          |
| 9        | 2020-08-07 | 2           | 3          |
| 10       | 2020-07-15 | 1           | 2          |

Products table:

| product_id | product_name | price |
|------------|--------------|-------|
| 1          | keyboard     | 120   |
| 2          | mouse        | 80    |
| 3          | screen       | 600   |
| 4          | hard disk    | 450   |

### Output: 

| customer_id | product_id | product_name |
|-------------|------------|--------------|
| 1           | 2          | mouse        |
| 2           | 1          | keyboard     |
| 2           | 2          | mouse        |
| 2           | 3          | screen       |
| 3           | 3          | screen       |
| 4           | 1          | keyboard     |

### Explanation: 

* Alice (customer 1) ordered the mouse three times and the keyboard one time, so the mouse is the most frequently ordered product for them.
* Bob (customer 2) ordered the keyboard, the mouse, and the screen one time, so those are the most frequently ordered products for them.
* Tom (customer 3) only ordered the screen (two times), so that is the most frequently ordered product for them.
* Jerry (customer 4) only ordered the keyboard (one time), so that is the most frequently ordered product for them.
* John (customer 5) did not order anything, so we do not include them in the result table.  



<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
SELECT customer_id, product_id, product_name
FROM (
    SELECT O1.customer_id, O1.product_id, P1.product_name,
        DENSE_RANK() OVER(PARTITION BY O1.customer_id ORDER BY COUNT(O1.product_id) DESC) AS costomer_rank
    FROM Products P1
    JOIN Orders O1
    ON P1.product_id = O1.product_id
    GROUP BY customer_id, product_id
    ) T
WHERE costomer_rank = 1
ORDER BY 1, 2 DESC
```

## ğŸŸ¢ í’€ì´ (Discription)

ë¬¸ì œì—ì„œ íŒŒìƒë˜ëŠ” íŒíŠ¸ ì¡°ê±´ë“¤ì„ ë§Œì¡±ì‹œí‚¤ëŠ” ë¡œì§ì€ êµ¬í˜„í•˜ë©´ ì •ë‹µ ë„ì¶œì´ ì‰½ê²Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

* ë¬¸ì œì—ì„œ ìš”êµ¬í•˜ëŠ” ì •ë‹µì—ëŠ” `Products, Orders` ë‘ê°œë§Œ í•„ìš”í•©ë‹ˆë‹¤.  
* ìš”êµ¬í•˜ëŠ” ë°ì´í„°ëŠ” `customer_id` ë³„ë¡œ ì¡´ì¬í•˜ëŠ” `product_id` ê°œìˆ˜ê°€ ê°€ì¥ ë†’ì€ `product_name`ì˜ ì¶œë ¥ì…ë‹ˆë‹¤.    
* ì¦‰, íŠ¹ì • ê·¸ë£¹ì—ì„œ íŠ¹ì • ì»¬ëŸ¼ì˜ ê°¯ìˆ˜ ë³„ ë­í‚¹ì„ ë§¤ê¸°ëŠ” ë¡œì§ì…ë‹ˆë‹¤.  

<br/>

---

#### STEP. 1 [JOIN]

```sql
SELECT O1.customer_id, O1.product_id, P1.product_name
FROM Products P1
JOIN Orders O1
ON P1.product_id = O1.product_id
```

| customer_id | product_id | product_name |
| ----------- | ---------- | ------------ |
| 1           | 1          | keyboard     |
| 2           | 2          | mouse        |
| 3           | 3          | screen       |
| 4           | 1          | keyboard     |
| 1           | 2          | mouse        |
| 2           | 1          | keyboard     |
| 3           | 3          | screen       |
| 1           | 2          | mouse        |
| 2           | 3          | screen       |
| 1           | 2          | mouse        |

ìœ„ì™€ ê°™ì´, `Products, Orders` í…Œì´ë¸”ì„ ê¸°ì¤€ì— ë§ê²Œ Join í•©ë‹ˆë‹¤.  

<br/>  


#### STEP. 2 [GROUP BY - RANK()]

```sql
SELECT O1.customer_id, O1.product_id, P1.product_name,
    DENSE_RANK() OVER(PARTITION BY O1.customer_id ORDER BY COUNT(O1.product_id) DESC) AS costomer_rank
FROM Products P1
JOIN Orders O1
ON P1.product_id = O1.product_id
GROUP BY customer_id, product_id
```

| customer_id | product_id | product_name | costomer_rank |
| ----------- | ---------- | ------------ | ------------- |
| 1           | 2          | mouse        | 1             |
| 1           | 1          | keyboard     | 2             |
| 2           | 2          | mouse        | 1             |
| 2           | 1          | keyboard     | 1             |
| 2           | 3          | screen       | 1             |
| 3           | 3          | screen       | 1             |
| 4           | 1          | keyboard     | 1             |  

ìœ„ì™€ ê°™ì´, `customer_id, product_id`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ `product_id`ì˜ ê°¯ìˆ˜ë¥¼ êµ¬í•´ì•¼ í•©ë‹ˆë‹¤.  

* DENSE_RANK() OVER(PARTITION BY O1.customer_id ORDER BY COUNT(O1.product_id) DESC) // ë”°ë¼ì„œ COUNTë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ RANKë¥¼ êµ¬í•˜ë©´ ë©ë‹ˆë‹¤.  

<br/>

---


#### STEP. 3 [WHERE- Filtering]

```sql
SELECT customer_id, product_id, product_name
FROM (
    SELECT O1.customer_id, O1.product_id, P1.product_name,
        DENSE_RANK() OVER(PARTITION BY O1.customer_id ORDER BY COUNT(O1.product_id) DESC) AS costomer_rank
    FROM Products P1
    JOIN Orders O1
    ON P1.product_id = O1.product_id
    GROUP BY customer_id, product_id
    ) T
WHERE costomer_rank = 1
ORDER BY 1, 2 DESC
```  

| customer_id | product_id | product_name |
| ----------- | ---------- | ------------ |
| 1           | 2          | mouse        |
| 2           | 3          | screen       |
| 2           | 2          | mouse        |
| 2           | 1          | keyboard     |
| 3           | 3          | screen       |
| 4           | 1          | keyboard     |

ìµœì¢…ì ìœ¼ë¡œ ì§‘ê³„í•œ Rankê°€ (ê°œìˆ˜) ì œì¼ ë†’ì€ ë°ì´í„°ë§Œ Filteringí•˜ë©´ ì •ë‹µì´ ë„ì¶œë©ë‹ˆë‹¤. 