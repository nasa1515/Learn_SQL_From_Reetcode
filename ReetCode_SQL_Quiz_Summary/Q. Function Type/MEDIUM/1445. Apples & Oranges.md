## [1445. Apples & Oranges]  


### Table: Sales


| Column Name   | Type    |
|---------------|---------|
| sale_date     | date    |
| fruit         | enum    | 
| sold_num      | int     | 

(sale_date, fruit) is the primary key (combination of columns with unique values) of this table.  
This table contains the sales of "apples" and "oranges" sold each day.  
 
## Problem 

Write a solution to report the difference between the number of apples and oranges sold each day.  

Return the result table ordered by sale_date.  

The result format is in the following example.  

 

## Example 1:

### Input: 

Sales table:


| sale_date  | fruit      | sold_num    |
|------------|------------|-------------|
| 2020-05-01 | apples     | 10          |
| 2020-05-01 | oranges    | 8           |
| 2020-05-02 | apples     | 15          |
| 2020-05-02 | oranges    | 15          |
| 2020-05-03 | apples     | 20          |
| 2020-05-03 | oranges    | 0           |
| 2020-05-04 | apples     | 15          |
| 2020-05-04 | oranges    | 16          |

### Output: 

| sale_date  | diff         |
|------------|--------------|
| 2020-05-01 | 2            |
| 2020-05-02 | 0            |
| 2020-05-03 | 20           |
| 2020-05-04 | -1           |

### Explanation: 

* Day 2020-05-01, 10 apples and 8 oranges were sold (Difference  10 - 8 = 2).
* Day 2020-05-02, 15 apples and 15 oranges were sold (Difference 15 - 15 = 0).
* Day 2020-05-03, 20 apples and 0 oranges were sold (Difference 20 - 0 = 20).
* Day 2020-05-04, 15 apples and 16 oranges were sold (Difference 15 - 16 = -1).  



<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
SELECT sale_date,
       (sold_num - sold_orange) AS diff
FROM (
    SELECT *,
        LEAD(sold_num, 1) OVER(PARTITION BY sale_date ORDER BY fruit ASC) AS sold_orange
    FROM Sales) T
WHERE sold_orange IS NOT NULL
GROUP BY sale_date
```

## ğŸŸ¢ í’€ì´ (Discription)  

ì •ë§ ê°„ë‹¨í•œ ë¡œì§ìœ¼ë¡œ í’€ì´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.  (ì•„ë˜ì˜ íŒíŠ¸ë¥¼ ì°¸ê³ í•˜ì‹œë©´ ë©ë‹ˆë‹¤.)  

* grouping ì§€ì–´ì„œ ê³„ì‚°í•´ì•¼ í•  ì»¬ëŸ¼ì€ `sale_date` ì…ë‹ˆë‹¤.  
* fruit ì»¬ëŸ¼ì˜ ê²½ìš° enumìœ¼ë¡œ ë‹¨ìˆœíˆ `apples, oranges`ë¥¼ ë°˜ë³µí•©ë‹ˆë‹¤.  
* fruitë¥¼ ì •ë ¬ ì‹œ ì•ŒíŒŒë²³ ìˆœìœ¼ë¡œ ì •ë ¬ë©ë‹ˆë‹¤.  


<br/>

#### STEP. 1 [Window LEAD]  

```sql
SELECT *,
    LEAD(sold_num, 1) OVER(PARTITION BY sale_date ORDER BY fruit ASC) AS sold_orange
FROM Sales
```

| sale_date  | fruit   | sold_num | sold_orange |
| ---------- | ------- | -------- | ----------- |
| 2020-05-01 | apples  | 10       | 8           |
| 2020-05-01 | oranges | 8        | null        |
| 2020-05-02 | apples  | 15       | 15          |
| 2020-05-02 | oranges | 15       | null        |
| 2020-05-03 | apples  | 20       | 0           |
| 2020-05-03 | oranges | 0        | null        |
| 2020-05-04 | apples  | 15       | 16          |
| 2020-05-04 | oranges | 16       | null        |  

ìœ„ì™€ ê°™ì´, `LEAD`ë¥¼ ì‚¬ìš©í•˜ë©° 1ì»¬ëŸ¼ ì´í›„ì˜ ê°’ì„ ê°€ì ¸ì˜µë‹ˆë‹¤.  
ê·¸ëŸ¬ë©´ Apples ì—ëŠ” oranges ì»¬ëŸ¼ì˜ ë°ì´í„°ê°€ ë¶ˆëŸ¬ì™€ì§€ê²Œ ë©ë‹ˆë‹¤.  

* PARTITION BY sale_date // sale_dateë¥¼ Partition
* fruit ì»¬ëŸ¼ì„ ê¸°ì¤€ìœ¼ë¡œ asending  

<br/>

---



#### STEP. 2 [WHERE AND GROUP BY]  

```sql
SELECT sale_date, (sold_num - sold_orange) AS diff
FROM (
    SELECT *,
        LEAD(sold_num, 1) OVER(PARTITION BY sale_date ORDER BY fruit ASC) AS sold_orange
    FROM Sales) T
WHERE sold_orange IS NOT NULL
GROUP BY sale_date
```

| sale_date  | diff |
| ---------- | ---- |
| 2020-05-01 | 2    |
| 2020-05-02 | 0    |
| 2020-05-03 | 20   |
| 2020-05-04 | -1   |  

ìœ„ì™€ ê°™ì´ WHERE, GROUP BYë¥¼ ì‚¬ìš©í•´ì„œ, í•„í„°ë§í•œ ë°ì´í„°ë¥¼ ì§‘ê³„í•©ë‹ˆë‹¤.  

* WHERE sold_orange IS NOT NULL // LEADì—ì„œ ì¡°íšŒë˜ì§€ ì•Šì€ ê²½ìš°ë¥¼ ì œì™¸
* GROUP BY sale_date // ë™ì¼í•œ ë‚ ì˜ ë°ì´í„°ê°€ ì—¬ëŸ¬ê°œ ìˆì„ ìˆ˜ë„ ìˆëŠ” ê²½ìš°ë¥¼ ê·¸ë£¹í•‘.
* (sold_num - sold_orange) AS diff // ì§‘ê³„ ê³„ì‚°.
