## [1468. Calculate Salaries]  


### Table Salaries:


| Column Name   | Type    |
|---------------|---------|
| company_id    | int     |
| employee_id   | int     |
| employee_name | varchar |
| salary        | int     |

In SQL,(company_id, employee_id) is the primary key for this table.  
This table contains the company id, the id, the name, and the salary for an employee.  
 
## Problem 

Find the salaries of the employees after applying taxes. Round the salary to the nearest integer.  

The tax rate is calculated for each company based on the following criteria:  

0% If the max salary of any employee in the company is less than $1000.  
24% If the max salary of any employee in the company is in the range [1000, 10000] inclusive.  
49% If the max salary of any employee in the company is greater than $10000.  
Return the result table in any order.  

The result format is in the following example.  

 

## Example 1:

### Input: 

Salaries table:


| company_id | employee_id | employee_name | salary |
|------------|-------------|---------------|--------|
| 1          | 1           | Tony          | 2000   |
| 1          | 2           | Pronub        | 21300  |
| 1          | 3           | Tyrrox        | 10800  |
| 2          | 1           | Pam           | 300    |
| 2          | 7           | Bassem        | 450    |
| 2          | 9           | Hermione      | 700    |
| 3          | 7           | Bocaben       | 100    |
| 3          | 2           | Ognjen        | 2200   |
| 3          | 13          | Nyancat       | 3300   |
| 3          | 15          | Morninngcat   | 7777   |

### Output: 

| company_id | employee_id | employee_name | salary |
|------------|-------------|---------------|--------|
| 1          | 1           | Tony          | 1020   |
| 1          | 2           | Pronub        | 10863  |
| 1          | 3           | Tyrrox        | 5508   |
| 2          | 1           | Pam           | 300    |
| 2          | 7           | Bassem        | 450    |
| 2          | 9           | Hermione      | 700    |
| 3          | 7           | Bocaben       | 76     |
| 3          | 2           | Ognjen        | 1672   |
| 3          | 13          | Nyancat       | 2508   |
| 3          | 15          | Morninngcat   | 5911   |

### Explanation:

* For company 1, Max salary is 21300. Employees in company 1 have taxes = 49%
* For company 2, Max salary is 700. Employees in company 2 have taxes = 0%
* For company 3, Max salary is 7777. Employees in company 3 have taxes = 24%
* The salary after taxes = salary - (taxes percentage / 100) * salary
* For example, Salary for Morninngcat (3, 15) after taxes = 7777 - 7777 * (24 / 100) = 7777 - 1866.48 = 5910.52, which is rounded to 5911.



<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
SELECT company_id, employee_id, employee_name,
       CASE WHEN MAX(salary) OVER(PARTITION BY company_id) > 10000 THEN ROUND(salary - (salary * 0.49))
            WHEN MAX(salary) OVER(PARTITION BY company_id) BETWEEN 1000 and 10000 THEN ROUND(salary - (salary * 0.24))
            ELSE salary END AS salary
FROM Salaries 
```

## ğŸŸ¢ í’€ì´ (Discription)

êµ‰ì¥íˆ ê°„ë‹¨í•œ ë¬¸ì œì…ë‹ˆë‹¤. ë¬¸ì œì˜ íŒíŠ¸ë§Œ ì˜ í™œìš©í•˜ì—¬ êµ¬í˜„í•˜ë©´ ë©ë‹ˆë‹¤.  

* salaryì˜ ìˆ«ì ë²”ìœ„ ëŒ€ë¡œ ì„¸ê¸ˆì´ ì •í•´ì§„ë‹¤. 
* í•´ë‹¹ ìˆ«ì ë²”ìœ„ëŠ” `company_id`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê°€ì¥ í° salary ìˆ«ìë¡œ ì •í•´ì§„ë‹¤.  


<br/>

#### STEP. 1 [MAX() PARTITION í•¨ìˆ˜]

```sql
SELECT company_id, employee_id, employee_name,
       MAX(salary) OVER(PARTITION BY company_id) as max_Value
FROM Salaries 
```

| company_id | employee_id | employee_name | max_Value |
| ---------- | ----------- | ------------- | --------- |
| 1          | 1           | Tony          | 21300     |
| 1          | 2           | Pronub        | 21300     |
| 1          | 3           | Tyrrox        | 21300     |
| 2          | 1           | Pam           | 700       |
| 2          | 7           | Bassem        | 700       |
| 2          | 9           | Hermione      | 700       |
| 3          | 7           | Bocaben       | 7777      |
| 3          | 2           | Ognjen        | 7777      |
| 3          | 13          | Nyancat       | 7777      |
| 3          | 15          | Morninngcat   | 7777      |

ìœ„ì™€ ê°™ì´, max() Windowë¥¼ ì‚¬ìš©í•´ì„œ `company_id` ë³„ë¡œ max_valueë¥¼ ì¶”ì¶œí•©ë‹ˆë‹¤.  
ì´ì œ `max_value`ì˜ ë²”ìœ„ëŒ€ë¡œ ê³„ì‚°ì‹ì„ ì ìš©í•˜ë©´ ì •ë‹µì…ë‹ˆë‹¤.  

#### STEP. 2 [CASE WHEN]

```sql
CASE WHEN MAX(salary) OVER(PARTITION BY company_id) > 10000 THEN ROUND(salary - (salary * 0.49))
     WHEN MAX(salary) OVER(PARTITION BY company_id) BETWEEN 1000 and 10000 THEN ROUND(salary - (salary * 0.24))
     ELSE salary END AS salary
```

ìœ„ì™€ ê°™ì´, ê°ê° CASE ë³„ë¡œ max_Valueì˜ ë²”ìœ„ë¥¼ ê¸°ì¤€ìœ¼ë¡œ, Round ê³„ì‚°ì‹ì„ ì…ë ¥í•´, ì •ë‹µì„ ë„ì¶œí•©ë‹ˆë‹¤.