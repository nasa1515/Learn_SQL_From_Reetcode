## [1934. Confirmation Rate]


### Table: Signups


| Column Name    | Type     |
|----------------|----------|
| user_id        | int      |
| time_stamp     | datetime |

user_id is the column of unique values for this table.  
Each row contains information about the signup time for the user with ID user_id.  
 

### Table: Confirmations


| Column Name    | Type     |
|----------------|----------|
| user_id        | int      |
| time_stamp     | datetime |
| action         | ENUM     |

(user_id, time_stamp) is the primary key (combination of columns with unique values) for this table.  
user_id is a foreign key (reference column) to the Signups table.  
action is an ENUM (category) of the type ('confirmed', 'timeout')  
Each row of this table indicates that the user with ID user_id requested a confirmation message at time_stamp and that confirmation message was either confirmed ('confirmed') or expired without confirming ('timeout').  
 

## Problem 

The confirmation rate of a user is the number of 'confirmed' messages divided by the total number of requested confirmation messages.  
The confirmation rate of a user that did not request any confirmation messages is 0. Round the confirmation rate to two decimal places.  

Write a solution to find the confirmation rate of each user.  

Return the result table in any order.  

The result format is in the following example.  

 

## Example 1:

### Input: 

Signups table:


| user_id | time_stamp          |
|---------|---------------------|
| 3       | 2020-03-21 10:16:13 |
| 7       | 2020-01-04 13:57:59 |
| 2       | 2020-07-29 23:09:44 |
| 6       | 2020-12-09 10:39:37 |

Confirmations table:

| user_id | time_stamp          | action    |
|---------|---------------------|-----------|
| 3       | 2021-01-06 03:30:46 | timeout   |
| 3       | 2021-07-14 14:00:00 | timeout   |
| 7       | 2021-06-12 11:57:29 | confirmed |
| 7       | 2021-06-13 12:58:28 | confirmed |
| 7       | 2021-06-14 13:59:27 | confirmed |
| 2       | 2021-01-22 00:00:00 | confirmed |
| 2       | 2021-02-28 23:59:59 | timeout   |

### Output: 

| user_id | confirmation_rate |
|---------|-------------------|
| 6       | 0.00              |
| 3       | 0.00              |
| 7       | 1.00              |
| 2       | 0.50              |

### Explanation: 

* User 6 did not request any confirmation messages. The confirmation rate is 0.
* User 3 made 2 requests and both timed out. The confirmation rate is 0.
* User 7 made 3 requests and all were confirmed. The confirmation rate is 1.
* User 2 made 2 requests where one was confirmed and the other timed out. The confirmation rate is 1 / 2 = 0.5.


<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## üü¢ ÎãµÏïà (SQL Solution)

```sql
SELECT user_id, ROUND(CONFIRM_COUNT/ALL_COUNT, 2) AS confirmation_rate
FROM (
    SELECT DISTINCT(S.user_id), 
           SUM(CASE WHEN C.action="confirmed" THEN 1 ELSE 0 END) OVER (PARTITION BY S.user_id) AS CONFIRM_COUNT,
           SUM(CASE WHEN C.action="timeout" THEN 1 ELSE 0 END) OVER (PARTITION BY S.user_id) AS TIMEOUT_COUNT,
           COUNT(*) OVER (PARTITION BY S.user_id) AS ALL_COUNT
    FROM Signups S
    LEFT JOIN Confirmations C
    ON S.user_id = C.user_id) AS TEMP
```

## üü¢ ÌíÄÏù¥ (Discription)
`Subquery`Î•º ÏÇ¨Ïö©Ìï¥ `action` Ïª¨ÎüºÏùò Í∞íÏùÑ Íµ¨Î∂ÑÌïú Í∏∞Ï§Ä Í∞íÏùò Í∞úÏàòÎ•º ÌïÑÌÑ∞ÎßÅÌï¥ÏÑú Îç∞Ïù¥ÌÑ∞Î•º ÏßëÍ≥ÑÌï¥ Ìï¥Í≤∞ÌñàÏäµÎãàÎã§.   
Î¨∏Ï†úÏóêÏÑú ÎÇòÏò® Ï°∞Í±¥Ïóê Îî∞ÎùºÏÑú, ÌíÄÏù¥Î•º ÎåÄÏã†ÌïòÍ≤†ÏäµÎãàÎã§. 

#### 1. `Signups Table`ÏóêÎßå Ï°¥Ïû¨ÌïòÍ≥†, Ìä∏ÎûúÏû≠ÏÖò Í≤∞Í≥ºÏù∏ `Confirmations`Ïóî Ï°¥Ïû¨ÌïòÏßÄ ÏïäÏïÑÎèÑ, ÏßëÍ≥Ñ Í≤∞ÏÇ∞ÏùÄ ÎÇòÏôÄÏïº ÌïúÎã§.  
`(Ï¶â Signups ÌÖåÏù¥Î∏îÏùÑ Í∏∞Ï§ÄÏúºÎ°ú Join Ï°∞Í±¥)`   

#### 2. Ï¥ù Ìä∏ÎûúÏû≠ÏÖòÏùò ÎπÑÏú® Ï§ëÏóê `confirmed` Í∞Ä Ï∞®ÏßÄÌïòÎäî ÎπÑÏú®ÏùÑ Íµ¨ÌïòÎäî Î¨∏Ï†ú, Ï¶â, Í∞ÅÍ∞Å actionÏùò Í∞úÏàòÎ•º Íµ¨ÌïòÎ©¥ Í≥ÑÏÇ∞Ïù¥ Í∞ÄÎä•.  
`(CASE WHEN Íµ¨Î¨∏ÏúºÎ°ú ÎπÑÍµê Í∞ÄÎä•Ìïú Ï¶ùÍ±∞)`  


#### Window Case When Íµ¨Î¨∏ÏóêÏÑú Ï£ºÏùòÌï¥Ïïº Ìï† Ï†ê.

```sql 
SELECT S.user_id, 
       SUM(CASE WHEN C.action="confirmed" THEN 1 ELSE 0 END) OVER (PARTITION BY S.user_id) AS CONFIRM_COUNT,
       SUM(CASE WHEN C.action="timeout" THEN 1 ELSE 0 END) OVER (PARTITION BY S.user_id) AS TIMEOUT_COUNT,
       COUNT(*) OVER (PARTITION BY S.user_id) AS ALL_COUNT
FROM Signups S
LEFT JOIN Confirmations C
ON S.user_id = C.user_id
```
`Window Partition`ÏùÄ `Group by` Íµ¨Î¨∏Í≥º Í∞ôÏù¥ Ïì∞ÏßÄ ÏïäÎäî Ïù¥ÏÉÅ ÌÖåÏù¥Î∏îÏùò Ï†ÑÏ≤¥ RowsÏóê Ìï¥ÎãπÌïòÎäî Îç∞Ïù¥ÌÑ∞Í∞Ä  
`Partition by` Îã®ÏúÑÎ°ú Î™®Îëê Í≥ÑÏÇ∞Îê©ÎãàÎã§. Ï¶â Í≤∞Í≥º Îç∞Ïù¥ÌÑ∞Ïóê Ï§ëÎ≥µÏù¥ Î∞úÏÉùÌï† Ïàò Î∞ñÏóê ÏóÜÎäî Íµ¨Ï°∞Ïùò Í≥ÑÏÇ∞ Î°úÏßÅ ÏûÖÎãàÎã§.  

#### Í≤∞Í≥º

| user_id | CONFIRM_COUNT | TIMEOUT_COUNT | ALL_COUNT |
| ------- | ------------- | ------------- | --------- |
| 2       | 1             | 1             | 2         |
| 2       | 1             | 1             | 2         |
| 3       | 0             | 2             | 2         |
| 3       | 0             | 2             | 2         |
| 6       | 0             | 0             | 1         |
| 7       | 3             | 0             | 3         |
| 7       | 3             | 0             | 3         |
| 7       | 3             | 0             | 3         |...  

Îã§ÏùåÍ≥º Í∞ôÏùÄ Í≤∞Í≥ºÎ°ú ÎÇòÌÉÄÎÇòÍ≤å ÎêòÎäîÎç∞, Ïù¥ Í≤∞Í≥ºÎì§Ïùò Ï§ëÎ≥µÏù¥ ÎÑàÎ¨¥ ÎßéÏïÑ `user_id` Í∏∞Ï§ÄÏúºÎ°ú `Group by`Î•º ÌïòÍ≥† Ïã∂ÏäµÎãàÎã§.  
ÌïúÎ≤à Ìï¥Î≥¥Î©¥ Í≤∞Í≥ºÍ∞Ä Ïñ¥ÎñªÍ≤å Îê†ÍπåÏöî??   

#### Group by ÏøºÎ¶¨

```sql
SELECT S.user_id, 
       SUM(CASE WHEN C.action="confirmed" THEN 1 ELSE 0 END) OVER (PARTITION BY S.user_id) AS CONFIRM_COUNT,
       SUM(CASE WHEN C.action="timeout" THEN 1 ELSE 0 END) OVER (PARTITION BY S.user_id) AS TIMEOUT_COUNT,
       COUNT(*) OVER (PARTITION BY S.user_id) AS ALL_COUNT
FROM Signups S
LEFT JOIN Confirmations C
ON S.user_id = C.user_id
GROUP BY S.user_id
```

#### Group by ÏøºÎ¶¨ Í≤∞Í≥º

| user_id | CONFIRM_COUNT | TIMEOUT_COUNT | ALL_COUNT |
| ------- | ------------- | ------------- | --------- |
| 2       | 0             | 1             | 1         |
| 3       | 0             | 1             | 1         |
| 6       | 0             | 0             | 1         |
| 7       | 1             | 0             | 1         |...  

Ïö∞ÏÑ† `user_id` Í∏∞Ï§ÄÏúºÎ°ú, Í∑∏Î£πÌïëÎêú Í∞íÏùò Ï∂úÎ†•ÏùÄ Ï†ïÏÉÅÏ†ÅÏûÖÎãàÎã§.  
Í∑ºÎç∞, Í∞ÅÍ∞Å `Window`Î°ú Í≥ÑÏÇ∞ÎêòÏñ¥Ïïº Ìï† Í∞íÎì§Ïù¥ Ïù¥ÏÉÅÌïòÍ≤å ÎÇòÏôîÏäµÎãàÎã§.  
ÏõêÏù∏ÏùÄ `Window`Îäî ÏÑ†Ìñâ ÏøºÎ¶¨Ïùò Ï†ÑÏ≤¥ ÌñâÏùò Í≤∞Í≥ºÎ•º Í∞ÄÏßÄÍ≥† ÏßëÍ≥ÑÍ∞Ä ÎêòÍ∏∞ ÏãúÏûëÌïòÎäîÎç∞.  
Ïù¥ÎØ∏ `Group by` ÏøºÎ¶¨Î°ú Í∞Å ÏÑ†Ìñâ ÏøºÎ¶¨ Ï†ÑÏ≤¥ÌñâÏùò Í≤∞Í≥ºÎ•º `1Í∞ú`Î°ú Í∑∏Î£πÌïë ÏãúÏº∞Í∏∞ ÎïåÎ¨∏Ïóê ÏµúÎåÄ Í∞íÏù¥ 1Ïù¥ Îê† Ïàò Î∞ñÏóê ÏóÜÏäµÎãàÎã§.  

#### Í∑∏Îüº Window Í≤∞Í≥ºÎ•º group by Ï≤òÎüº Í∑∏Î£πÌïë ÌïòÎ†§Î©¥..?  

`ÎãµÏïà`Ïóê ÌëúÏãúÎêú Í≤É Ï≤òÎüº, `Group by` -> `DISTINCT()`Î°ú Î∞îÍøîÏÑú Íµ¨ÌòÑÏù¥ Í∞ÄÎä•Ìï©ÎãàÎã§.  


