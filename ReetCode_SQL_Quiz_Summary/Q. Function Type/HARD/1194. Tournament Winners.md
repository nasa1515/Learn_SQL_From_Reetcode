## [1194. Tournament Winners]  

### Table: Players


| Column Name | Type  |
|-------------|-------|
| player_id   | int   |
| group_id    | int   |

player_id is the primary key (column with unique values) of this table.  
Each row of this table indicates the group of each player.  

### Table: Matches


| Column Name   | Type    |
|---------------|---------|
| match_id      | int     |
| first_player  | int     |
| second_player | int     | 
| first_score   | int     |
| second_score  | int     |

match_id is the primary key (column with unique values) of this table.  
Each row is a record of a match, first_player and second_player contain the player_id of each match.  
first_score and second_score contain the number of points of the first_player and second_player respectively.  
You may assume that, in each match, players belong to the same group.  
 
## Problem  

The winner in each group is the player who scored the maximum total points within the group.  
In the case of a tie, the lowest player_id wins.  

Write a solution to find the winner in each group.  

Return the result table in any order.  
 
The result format is in the following example.  

 

## Example 1:

### Input:   

Players table:


| player_id | group_id   |
|-----------|------------|
| 15        | 1          |
| 25        | 1          |
| 30        | 1          |
| 45        | 1          |
| 10        | 2          |
| 35        | 2          |
| 50        | 2          |
| 20        | 3          |
| 40        | 3          |

Matches table:

| match_id   | first_player | second_player | first_score | second_score |
|------------|--------------|---------------|-------------|--------------|
| 1          | 15           | 45            | 3           | 0            |
| 2          | 30           | 25            | 1           | 2            |
| 3          | 30           | 15            | 2           | 0            |
| 4          | 40           | 20            | 5           | 2            |
| 5          | 35           | 50            | 1           | 1            |

### Output: 

| group_id  | player_id  |
|-----------|------------| 
| 1         | 15         |
| 2         | 35         |
| 3         | 40         |



---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
WITH CTE AS (
SELECT *,  
       RANK() OVER(PARTITION BY group_id ORDER BY SUM(CASE WHEN player_id = first_player THEN first_score ELSE second_score END) DESC, player_id ASC) AS rk
FROM players	
JOIN matches 
ON player_id IN (first_player, second_player)
GROUP BY player_id, group_id 
) 

SELECT group_id as GROUP_ID, player_id AS PLAYER_ID
FROM CTE
WHERE rk = 1
```

## ğŸŸ¢ í’€ì´ (Discription)

ë¬¸ì œì—ì„œ ë„ì¶œë˜ëŠ” íŒíŠ¸ë“¤ì„ ì¢…í•©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¡°ê±´ë“¤ì„ ìƒì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

* ë¬¸ì œëŠ”, `Matches` í…Œì´ë¸”ì—ì„œ ê° `player_id`ì˜ GROUP ë³„ë¡œ ê°€ì¥ ë†’ì€ ì ìˆ˜ë¥¼ íœ™ë“í•œ User ë§Œ ì¶œë ¥í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.  
* í•˜ë‚˜ì˜ ì»¬ëŸ¼ì— ë‘ê°œì˜ `player_id` ë°ì´í„°ê°€ ì¡´ì¬í•˜ë©°, ë”°ë¡œ ì§‘ê³„ê°€ í•„ìš”í•©ë‹ˆë‹¤. 

<br/>



#### STEP. 1 [GROUP BY ì§‘ê³„í•˜ê¸°]  

```sql
SELECT *
FROM players
JOIN matches 
ON player_id IN (first_player, second_player)
```

| player_id | group_id | match_id | first_player | second_player | first_score | second_score |
| --------- | -------- | -------- | ------------ | ------------- | ----------- | ------------ |
| 15        | 1        | 3        | 30           | 15            | 2           | 0            |
| 15        | 1        | 1        | 15           | 45            | 3           | 0            |
| 20        | 3        | 4        | 40           | 20            | 5           | 2            |
| 25        | 1        | 2        | 30           | 25            | 1           | 2            |
| 30        | 1        | 3        | 30           | 15            | 2           | 0            |
| 30        | 1        | 2        | 30           | 25            | 1           | 2            |
| 35        | 2        | 5        | 35           | 50            | 1           | 1            |
| 40        | 3        | 4        | 40           | 20            | 5           | 2            |
| 45        | 1        | 1        | 15           | 45            | 3           | 0            |
| 50        | 2        | 5        | 35           | 50            | 1           | 1            |  

ìœ„ì™€ ê°™ì´, first_player - second_playerì˜ ëª¨ë“  `player_id`ì˜ `Score` ê³„ì‚°ì„ ìœ„í•œ Joinì„ ì§„í–‰í•©ë‹ˆë‹¤.  

* ì´ì œ player_idëŠ” ë‘ê°œë¡œ ì¤‘ë³µë˜ì–´ ë°ì´í„°ê°€ ìƒì„±ë˜ê³ , ë‚˜ë¦„ì˜ ê·œì¹™ì´ ë³´ì´ê²Œ ë©ë‹ˆë‹¤. (player_id=first_player)

<br/>  


#### STEP. 2 [GROUP BY - Window RANK ì§‘ê³„]  

```sql
SELECT *,  
       RANK() OVER(PARTITION BY group_id ORDER BY SUM(CASE WHEN player_id = first_player THEN first_score ELSE second_score END) DESC, player_id ASC) AS rk
FROM players	
JOIN matches 
ON player_id IN (first_player, second_player)
GROUP BY player_id, group_id 
```

| player_id | group_id | match_id | first_player | second_player | first_score | second_score | rk |
| --------- | -------- | -------- | ------------ | ------------- | ----------- | ------------ | -- |
| 15        | 1        | 3        | 30           | 15            | 2           | 0            | 1  |
| 30        | 1        | 3        | 30           | 15            | 2           | 0            | 2  |
| 25        | 1        | 2        | 30           | 25            | 1           | 2            | 3  |
| 45        | 1        | 1        | 15           | 45            | 3           | 0            | 4  |
| 35        | 2        | 5        | 35           | 50            | 1           | 1            | 1  |
| 50        | 2        | 5        | 35           | 50            | 1           | 1            | 2  |
| 40        | 3        | 4        | 40           | 20            | 5           | 2            | 1  |
| 20        | 3        | 4        | 40           | 20            | 5           | 2            | 2  |  

ë‹¤ìŒê³¼ ê°™ì´ `player_id, group_id ` ì„ ê¸°ì¤€ìœ¼ë¡œ Grouping í•œ ë’¤  
ê° ì»¬ëŸ¼ì— ëŒ€í•œ Ranking Dataë¥¼ ìƒì„±í•©ë‹ˆë‹¤.    

* RANK() OVER(PARTITION BY group_id ORDER BY SUM(CASE WHEN player_id = first_player THEN first_score ELSE second_score END) DESC, player_id ASC) AS rk  

`player_id, group_id ` ê¸°ì¤€ Grouby List ì¤‘ `group_id`ë¡œ Grouping í•œ ë’¤, `player_id = first_player ì¡°ê±´ì— ë§ëŠ” Sum ê°’ì˜ ë­í‚¹ì„ ìƒì„±í•©ë‹ˆë‹¤.`    
ì´ ê²½ìš° first_scoreì— í•´ë‹¹í•˜ëŠ” score ì™€, second_score ê°’ ëª¨ë‘ í•©ì‚° í•œ ê²°ê³¼ë¡œ ë¹„êµê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

<br/>




#### STEP. 3 [Where Filtering]  

```sql
WITH CTE AS (
SELECT *,  
       RANK() OVER(PARTITION BY group_id ORDER BY SUM(CASE WHEN player_id = first_player THEN first_score ELSE second_score END) DESC, player_id ASC) AS rk
FROM players	
JOIN matches 
ON player_id IN (first_player, second_player)
GROUP BY player_id, group_id 
) 

SELECT group_id as GROUP_ID, player_id AS PLAYER_ID
FROM CTE
WHERE rk = 1
```

| GROUP_ID | PLAYER_ID |
| -------- | --------- |
| 1        | 15        |
| 2        | 35        |
| 3        | 40        |  

`WHERE rk = 1`ì„ ì‚¬ìš©í•´ì„œ, ìµœì¢…ì ìœ¼ë¡œ ê·¸ë£¹ ë³„ ê°€ì¥ RANK ê°’ì´ ë†’ì€ ê²°ê³¼ë§Œ ì¶œë ¥í•˜ë©´ ì •ë‹µì…ë‹ˆë‹¤.
