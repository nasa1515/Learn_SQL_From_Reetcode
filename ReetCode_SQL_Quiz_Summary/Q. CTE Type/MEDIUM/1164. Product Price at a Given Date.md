## [1164. Product Price at a Given Date]


### Table: Products


| Column Name   | Type    |
|---------------|---------|
| product_id    | int     |
| new_price     | int     |
| change_date   | date    |

(product_id, change_date) is the primary key (combination of columns with unique values) of this table.  
Each row of this table indicates that the price of some product was changed to a new price at some date.  
 
## Problem 

Write a solution to find the prices of all products on 2019-08-16.  
Assume the price of all products before any change is 10.  

Return the result table in any order.  

The result format is in the following example.  

 

## Example 1:

### Input: 

Products table:


| product_id | new_price | change_date |
|------------|-----------|-------------|
| 1          | 20        | 2019-08-14  |
| 2          | 50        | 2019-08-14  |
| 1          | 30        | 2019-08-15  |
| 1          | 35        | 2019-08-16  |
| 2          | 65        | 2019-08-17  |
| 3          | 20        | 2019-08-18  |

### Output: 

| product_id | price |
|------------|-------|
| 2          | 50    |
| 1          | 35    |
| 3          | 10    |


<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ðŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
WITH TEMP AS (
    SELECT product_id, new_price AS price, DENSE_RANK() OVER (PARTITION BY product_id ORDER BY change_date DESC) as cc
    FROM Products
    WHERE change_date <= '2019-08-16')

SELECT product_id, price FROM TEMP 
WHERE cc = 1
UNION
SELECT product_id, 10 AS price
FROM Products
WHERE product_id NOT IN (SELECT product_id FROM TEMP)
```

## ðŸŸ¢ í’€ì´ (Discription)
`CTE`ë¥¼ ì‚¬ìš©í•´ `change_date` ì»¬ëŸ¼ì˜ ê°’ì´ `2019-08-16` ì´ì „ì— ì¡´ìž¬í–ˆë˜ `product_id` ê°’ì„ ì§‘ê³„í•˜ê³   
ì´í›„ì˜ ê°’ë“¤ë§Œ ì¡´ìž¬í•˜ëŠ” `product_id` ê°’ì€ ëª¨ë‘ `10`ìœ¼ë¡œ ì¹˜í™˜í•œ ë°ì´í„°ë¥¼ `Union` í•´ì„œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.   
ë¬¸ì œì—ì„œ ë‚˜ì˜¨ ì¡°ê±´ì— ë”°ë¼ì„œ, í’€ì´ë¥¼ ëŒ€ì‹ í•˜ê² ìŠµë‹ˆë‹¤. 

1. `2019-08-16` ì´ë‚˜, ê·¸ ì´ì „ ë°ì´í„°ê°€ ìžˆë‹¤ë©´, í•´ë‹¹ `price`ê°’ì„ ê·¸ëŒ€ë¡œ ê°€ì ¸ì˜¤ë©´ ë©ë‹ˆë‹¤.  

### RANK() í•¨ìˆ˜ë¡œ, ì—¬ëŸ¬ê°€ì§€ ì¡´ìž¬í•  ìˆ˜ ìžˆëŠ” ê²ƒì¤‘, ê°€ìž¥ `2019-08-16` ê°€ê¹Œìš´ ê°’ ë„ì¶œ

```sql
WITH TEMP AS (
    SELECT product_id, new_price AS price, DENSE_RANK() OVER (PARTITION BY product_id ORDER BY change_date DESC) as cc
    FROM Products
    WHERE change_date <= '2019-08-16')
```

### RANK() ë„ì¶œ ê²°ê³¼ (cc - Rank, ì œì¼ ë†’ì€ê²Œ ê°€ìž¥ ê°€ê¹Œìš´ ê²ƒ)

| product_id | price | cc |
| ---------- | ----- | -- |
| 1          | 35    | 1  |
| 1          | 30    | 2  |
| 1          | 20    | 3  |
| 2          | 50    | 1  |

### ë„ì¶œ ëœ ë°ì´í„°ì™€ ë‚˜ë¨¸ì§€ ë°ì´í„°ë¥¼ Union

```sql
SELECT product_id, price FROM TEMP //
WHERE cc = 1 // temp ë°ì´í„°ì—ì„œ Rank ê°’ì´ 1ì¸ ê°’ë§Œ.
UNION
SELECT product_id, 10 AS price // ê°’ì„ ëª¨ë‘ 10ìœ¼ë¡œ ì¹˜í™˜
FROM Products
WHERE product_id NOT IN (SELECT product_id FROM TEMP) // product_id ê°€ temp table = (2019-08-16 ì´ì „ ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš°)ì— ì—†ëŠ” ê°’
```
ê²°ê³¼ì ìœ¼ë¡ , `temp` Table ì—ì„œëŠ” ê·¼ì ‘í•œ ê°€ê²©ì„ ê°€ì ¸ì˜¤ê³ , `temp` Tableì— ì¡°íšŒë˜ì§€ ì•ŠëŠ” ë°ì´í„°ëŠ” ëª¨ë‘ 10ìœ¼ë¡œ ì¹˜í™˜í•´ì„œ Union í•˜ëŠ” ë¡œì§ìœ¼ë¡œ í•´ê²°í–ˆìŠµë‹ˆë‹¤.