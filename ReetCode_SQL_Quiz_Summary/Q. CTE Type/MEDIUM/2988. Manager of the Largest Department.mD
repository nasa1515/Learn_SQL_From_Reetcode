## [2988. Manager of the Largest Department]


### Table: Employees


| Column Name | Type    |
|-------------|---------|
| emp_id      | int     |
| emp_name    | varchar |
| dep_id      | int     |
| position    | varchar |

emp_id is column of unique values for this table.  
This table contains emp_id, emp_name, dep_id, and position.  
Write a solution to find the name of the manager from the largest department.  
There may be multiple largest departments when the number of employees in those departments is the same.  

## Problem

Return the result table sorted by dep_id in ascending order.  

The result format is in the following example.  

 

## Example 1:

### Input: 

Employees table:

| emp_id | emp_name | dep_id | position      | 
|--------|----------|--------|---------------|
| 156    | Michael  | 107    | Manager       |
| 112    | Lucas    | 107    | Consultant    |    
| 8      | Isabella | 101    | Manager       | 
| 160    | Joseph   | 100    | Manager       | 
| 80     | Aiden    | 100    | Engineer      | 
| 190    | Skylar   | 100    | Freelancer    | 
| 196    | Stella   | 101    | Coordinator   |
| 167    | Audrey   | 100    | Consultant    |
| 97     | Nathan   | 101    | Supervisor    |
| 128    | Ian      | 101    | Administrator |
| 81     | Ethan    | 107    | Administrator |

### Output

| manager_name | dep_id | 
|--------------|--------|
| Joseph       | 100    | 
| Isabella     | 101    | 

### Explanation  

- Departments with IDs 100 and 101 each has a total of 4 employees, while department 107 has 3 employees. Since both departments 100 and 101 have an equal number of employees, their respective managers will be included.  

Output table is ordered by dep_id in ascending order.


---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
WITH CTE AS (
    SELECT dep_id,
        RANK() OVER(ORDER BY COUNT(emp_id) DESC) AS rnk
    FROM Employees
    GROUP BY dep_id
)

SELECT emp_name AS manager_name, dep_id
FROM Employees
WHERE position = 'Manager' and dep_id in (SELECT dep_id FROM CTE WHERE rnk = 1)
ORDER BY 2
```

## ğŸŸ¢ í’€ì´ (Discription)

ì•Œê³ ë¦¬ì¦˜ì„ ë– ì˜¬ë¦¬ê¸° êµ‰ì¥íˆ í˜ë“¤ì—ˆì§€ë§Œ, ë¬¸ì œì— ì§‘ì¤‘í•˜ë©´ íŠ¹ì • íŒ¨í„´ì´ ë³´ì˜€ìŠµë‹ˆë‹¤.  
ë¬¸ì œì—ì„œ ë„ì¶œë˜ëŠ” íŒíŠ¸ë“¤ì„ ì¢…í•©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¡°ê±´ë“¤ì„ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

* ë¬¸ì œëŠ” Employees í…Œì´ë¸”ì—ì„œ ê°€ì¥ ë§ì€ ì¢…ì—…ì›ì„ ê°€ì§„ department ì¤‘ì—, Manager Positionì„ ê°€ì§„ ì¢…ì—…ì›ì„ ì¶œë ¥í•˜ëŠ” ê°„ë‹¨í•œ ë¬¸ì œì…ë‹ˆë‹¤.  

<br/>



#### STEP. 1 [MAX() ê°’ì„ ì €ì¥í•˜ëŠ” cte ìƒì„±]  

```sql
WITH CTE AS (
    SELECT dep_id,
        RANK() OVER(ORDER BY COUNT(emp_id) DESC) AS rnk
    FROM Employees
    GROUP BY dep_id
)
```

| dep_id | rnk |
| ------ | --- |
| 101    | 1   |
| 100    | 1   |
| 107    | 3   |

ë‹¤ìŒ ê²°ê³¼ì™€ ê°™ì´, ê° ê·¸ë£¹ ë³„ë¡œ ì„ì§ì› ìˆ˜ë¡œ Rank() ë°ì´í„°ë¥¼ ìƒì„±í•´ ì§‘ê³„í•œ í…Œì´ë¸”ì„ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤.  

<br/>

#### STEP. 2 [WHERE Filtering]  

```sql
SELECT emp_name AS manager_name, dep_id
FROM Employees
WHERE position = 'Manager' and dep_id in (SELECT dep_id FROM CTE WHERE rnk = 1)
ORDER BY 2
```

| manager_name | dep_id |
| ------------ | ------ |
| Joseph       | 100    |
| Isabella     | 101    |

ìµœì¢…ì ìœ¼ë¡œ, ì§‘ê³„ëœ ë°ì´í„°ì—ì„œ where ì ˆ í•„í„°ë§ì„ í†µí•´ì„œ, ì•Œë§ëŠ” ë°ì´í„°ë§Œ ì¶œë ¥í•©ë‹ˆë‹¤.  

* positionì´ managerì¸ ë°ì´í„°
* dep_id ê°€ rnk ê°€ 1ì¸ ë¦¬ìŠ¤íŠ¸ ì¤‘ í¬í•¨ë˜ì–´ ìˆëŠ” ë°ì´í„°