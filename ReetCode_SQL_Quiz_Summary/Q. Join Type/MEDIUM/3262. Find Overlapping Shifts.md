## [3262. Find Overlapping Shifts]  


### Table: EmployeeShifts


| Column Name      | Type    |
|------------------|---------|
| employee_id      | int     |
| start_time       | time    |
| end_time         | time    |

(employee_id, start_time) is the unique key for this table.  
This table contains information about the shifts worked by employees, including the start and end times on a specific date.  
Write a solution to count the number of overlapping shifts for each employee. Two shifts are considered overlapping if one shiftâ€™s end_time is later than another shiftâ€™s start_time.  


## Problem

Return the result table ordered by employee_id in ascending order.  

The query result format is in the following example.  

 

## Example:

### Input:

EmployeeShifts table:


| employee_id | start_time | end_time |
|-------------|------------|----------|
| 1           | 08:00:00   | 12:00:00 |
| 1           | 11:00:00   | 15:00:00 |
| 1           | 14:00:00   | 18:00:00 |
| 2           | 09:00:00   | 17:00:00 |
| 2           | 16:00:00   | 20:00:00 |
| 3           | 10:00:00   | 12:00:00 |
| 3           | 13:00:00   | 15:00:00 |
| 3           | 16:00:00   | 18:00:00 |
| 4           | 08:00:00   | 10:00:00 |
| 4           | 09:00:00   | 11:00:00 |

### Output:


| employee_id | overlapping_shifts |
|-------------|--------------------|
| 1           | 2                  |
| 2           | 1                  |
| 4           | 1                  |

### Explanation:

* Employee 1 has 3 shifts:
    * 08:00:00 to 12:00:00
    * 11:00:00 to 15:00:00
    * 14:00:00 to 18:00:00
    * The first shift overlaps with the second, and the second overlaps with the third, resulting in 2 overlapping shifts.

* Employee 2 has 2 shifts:
    * 09:00:00 to 17:00:00
    * 16:00:00 to 20:00:00
    * These shifts overlap with each other, resulting in 1 overlapping shift.

* Employee 3 has 3 shifts:
    * 10:00:00 to 12:00:00
    * 13:00:00 to 15:00:00
    * 16:00:00 to 18:00:00
    * None of these shifts overlap, so Employee 3 is not included in the output.

* Employee 4 has 2 shifts:
    * 08:00:00 to 10:00:00
    * 09:00:00 to 11:00:00
    * These shifts overlap with each other, resulting in 1 overlapping shift.

* The output shows the employee_id and the count of overlapping shifts for each employee who has at least one overlapping shift, ordered by employee_id in ascending order.  



---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
SELECT e1.employee_id,
       COUNT(*) AS overlapping_shifts
FROM EmployeeShifts e1 JOIN EmployeeShifts e2
ON e1.employee_id=e2.employee_id
WHERE e1.start_time < e2.start_time AND e1.end_time > e2.start_time
GROUP BY e1.employee_id
ORDER BY employee_id
```

## ğŸŸ¢ í’€ì´ (Discription)

ì•Œê³ ë¦¬ì¦˜ì„ ë– ì˜¬ë¦¬ê¸° êµ‰ì¥íˆ í˜ë“¤ì—ˆì§€ë§Œ, ë¬¸ì œì— ì§‘ì¤‘í•˜ë©´ íŠ¹ì • íŒ¨í„´ì´ ë³´ì˜€ìŠµë‹ˆë‹¤.  
ë¬¸ì œì—ì„œ ë„ì¶œë˜ëŠ” íŒíŠ¸ë“¤ì„ ì¢…í•©í•˜ë©´ ì•„ë˜ì™€ ê°™ì€ ì¡°ê±´ë“¤ì„ ì •ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

* ë¬¸ì œëŠ” `EmployeeShifts`í…Œì´ë¸”ì—ì„œ, `start_time`ì´ ë‹¤ìŒ í–‰ì˜ `end_time` ë³´ë‹¤ ì‘ì€ ê²½ìš°ë¥¼ Countingí•˜ì—¬ ì¶œë ¥í•˜ëŠ” ë¬¸ì œì…ë‹ˆë‹¤.  
* ì¶œë ¥ì˜ ê²°ê³¼ë¥¼ ë³´ë©´ ì•„ë˜ì™€ ê°™ì€ íŒ¨í„´ì´ì¡´ì¬í•©ë‹ˆë‹¤.  
    * `LAG()` ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ë„, `Self Join`ìœ¼ë¡œ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì €ëŠ” `Self_JOIN`)  
    * ê²°êµ­ E1, E2ì™€ ê°™ì€ SELF JOIN í…Œì´ë¸”ì—ì„œ í›„í–‰ í…Œì´ë¸”ì´ ì¡°ê±´ì„, ë™ì¼í•œ `employee_id`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¡°íšŒí•˜ë©´ ì •ë‹µì…ë‹ˆë‹¤.


#### STEP. 1 [SELF JOIN - Groupby - count()]  

```
SELECT e1.employee_id,
       COUNT(*) AS overlapping_shifts
FROM EmployeeShifts e1 JOIN EmployeeShifts e2
ON e1.employee_id=e2.employee_id
WHERE e1.start_time < e2.start_time AND e1.end_time > e2.start_time
GROUP BY e1.employee_id
ORDER BY employee_id
```

ì´ë²ˆ ë¬¸ì œëŠ”, ë”°ë¡œ êµ¬ë¶„ëœ STEPìœ¼ë¡œ ë‚˜ëˆŒ í•„ìš”ê°€ ì—†ì´, `Self join` í›„ ì§‘ê³„ì— ëŒ€í•œ ê²°ê³¼ë§Œ ì¶œë ¥í•˜ë©´ ë©ë‹ˆë‹¤.  

* `e1.start_time < e2.start_time AND e1.end_time > e2.start_time` - whereë¡œ ë‹¤ìŒ start_timeì„ í•„í„°ë§ ë° ë‹¤ìŒ end_time ë³´ë‹¤ ì ì€ ê²½ìš°.

