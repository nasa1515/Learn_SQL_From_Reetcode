## [1747. Leetflex Banned Accounts]


### Table: LogInfo


| Column Name | Type     |
|-------------|----------|
| account_id  | int      |
| ip_address  | int      |
| login       | datetime |
| logout      | datetime |

This table may contain duplicate rows.  
The table contains information about the login and logout dates of Leetflex accounts.  
It also contains the IP address from which the account was logged in and out.  
It is guaranteed that the logout time is after the login time.  
 
## Problem 

Write a solution to find the account_id of the accounts that should be banned from Leetflex.  
An account should be banned if it was logged in at some moment from two different IP addresses.  

Return the result table in any order.  

The result format is in the following example.  

 

## Example 1:

### Input:  

LogInfo table: 

| account_id | ip_address | login               | logout              |
|------------|------------|---------------------|---------------------|
| 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |
| 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |
| 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |
| 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |
| 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |
| 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
| 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |
| 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |

### Output: 

| account_id |
|------------|
| 1          |
| 4          |

### Explanation: 
* Account ID 1 --> The account was active from "2021-02-01 09:00:00" to "2021-02-01 09:30:00" with two different IP addresses (1 and 2). It should be banned.
* Account ID 2 --> The account was active from two different addresses (6, 7) but in two different times.
* Account ID 3 --> The account was active from two different addresses (9, 13) on the same day but they do not intersect at any moment.
* Account ID 4 --> The account was active from "2021-02-01 17:00:00" to "2021-02-01 17:00:00" with two different IP addresses (10 and 11). It should be banned.  



<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
SELECT DISTINCT L1.account_id
FROM LogInfo L1, LogInfo L2
WHERE L1.account_id = L2.account_id 
AND L1.ip_address != L2.ip_address
AND L1.login BETWEEN L2.login AND L2.logout
ORDER BY 1
```

## ğŸŸ¢ í’€ì´ (Discription)

ë¬¸ì œì—ì„œ ë‚˜ì˜¤ëŠ” íŒíŠ¸ë“¤ì„ ìœ ì¶”í•´ì„œ, ì•„ë˜ì™€ ê°™ì€ ì¡°ê±´ì„ ë„ì¶œí•˜ë©´ ì‰½ê²Œ ë¬¸ì œ í’€ì´ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.  

* ë¬¸ì œëŠ” ë™ì¼í•œ `account_id`ì—ì„œ ë‹¤ë¥¸ `ip_address`ë¥¼ ê°€ì§„ Logì—ì„œ `login~logout` ì‹œê°„ì´ ì¤‘ë³µëœ ê²½ìš°ë¥¼ ì¶œë ¥í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤.  
* Tableì€ `LogInfo` í•˜ë‚˜ë¡œ, `Self join`ì´ í•„ìš”í•©ë‹ˆë‹¤.  
* `login~logout`ì˜ ì¤‘ë³µì„ ì•Œê¸° ìœ„í•´ì„œëŠ” `between`ì„ ì¨ì•¼í•  ê²ƒ ê°™ìŠµë‹ˆë‹¤.  

<br/>


#### STEP. 1 [SELF JOINìœ¼ë¡œ ì»¬ëŸ¼ ë¶™ì´ê¸°]  

```sql
SELECT *
FROM LogInfo L1, LogInfo L2
WHERE L1.account_id = L2.account_id 
ORDER BY 1
```

| account_id | ip_address | login               | logout              | account_id | ip_address | login               | logout              |
| ---------- | ---------- | ------------------- | ------------------- | ---------- | ---------- | ------------------- | ------------------- |
| 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 | 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |
| 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 | 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 |
| 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 | 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |
| 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 | 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |
| 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 | 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |
| 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 | 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 |
| 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 | 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |
| 2          | 6          | 2021-02-01 20:30:00 | 2021-02-01 22:00:00 | 2          | 7          | 2021-02-02 20:30:00 | 2021-02-02 22:00:00 |
| 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 | 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |
| 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 | 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 |
| 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 | 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
| 3          | 9          | 2021-02-01 16:00:00 | 2021-02-01 16:59:59 | 3          | 13         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
| 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 | 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |
| 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 | 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |
| 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 | 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |
| 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 | 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 |

ìœ„ì™€ ê°™ì´, `account_id`ê°€ ë™ì¼í•œ ê²½ìš°ì˜ ì¡°ê±´ìœ¼ë¡œë§Œ `Self join`ì„ ì¶œë ¥í•©ë‹ˆë‹¤.  ì—¬ê¸°ì„œ ìœ„ì˜ ì¡°ê±´ë“¤ì„ WHERE ì ˆì— ì¶”ê°€í•´ë³´ê² ìŠµë‹ˆë‹¤.  

<br/>


#### STEP. 2 [WHERE Filtering]

```sql
SELECT *
FROM LogInfo L1, LogInfo L2
WHERE L1.account_id = L2.account_id 
AND L1.ip_address != L2.ip_address
AND L1.login BETWEEN L2.login AND L2.logout
ORDER BY 1
```  

| account_id | ip_address | login               | logout              | account_id | ip_address | login               | logout              |
| ---------- | ---------- | ------------------- | ------------------- | ---------- | ---------- | ------------------- | ------------------- |
| 1          | 1          | 2021-02-01 09:00:00 | 2021-02-01 09:30:00 | 1          | 2          | 2021-02-01 08:00:00 | 2021-02-01 11:30:00 |
| 4          | 11         | 2021-02-01 17:00:00 | 2021-02-01 17:59:59 | 4          | 10         | 2021-02-01 16:00:00 | 2021-02-01 17:00:00 |  

ìœ„ì™€ ê°™ì´, ë‘ê°œì˜ ì¡°ê±´ì„ ì¶”ê°€í•˜ë©´, ì •ë‹µì˜ ì¡°ê±´ì„ í™•ë¦½ì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  

* L1.ip_address != L2.ip_address // ip_addressê°€ ë‹¤ë¥¸ ê²½ìš°
* L1.login BETWEEN L2.login AND L2.logout // login ë²”ìœ„ê°€, ë‹¤ë¥¸ ë¡œê·¸ì¸ ê¸°ë¡ì•ˆì— í¬í•¨ë˜ì–´ ìˆëŠ” ê²½ìš°   

<br/>


#### STEP. 2 [DISTINCT Filtering]

```sql
SELECT DISTINCT L1.account_id
FROM LogInfo L1, LogInfo L2
WHERE L1.account_id = L2.account_id 
AND L1.ip_address != L2.ip_address
AND L1.login BETWEEN L2.login AND L2.logout
ORDER BY 1
```

| account_id |
| ---------- |
| 1          |
| 4          |

ë¡œê·¸ì¸ ê¸°ë¡ì´ 3íšŒ ì´ìƒì¼ ê²½ìš°, `account_id`ì— ì¤‘ë³µì´ ìˆì„ ìˆ˜ ìˆì–´, `Distinct`ë¡œ ì¤‘ë³µì„ ì œê±°í•˜ë©´ ì •ë‹µì…ë‹ˆë‹¤.