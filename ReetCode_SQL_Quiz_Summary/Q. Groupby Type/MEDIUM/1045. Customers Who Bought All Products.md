## [1045. Customers Who Bought All Products]

### Table: Customer


| Column Name | Type    |
|-------------|---------|
| customer_id | int     |
| product_key | int     |

This table may contain duplicates rows.  
customer_id is not NULL.  
product_key is a foreign key (reference column) to Product table.  
 

### Table: Product


| Column Name | Type    |
|-------------|---------|
| product_key | int     |

product_key is the primary key (column with unique values) for this table.  
 
## Problem 

Write a solution to report the customer ids from the Customer table that bought all the products in the Product table.  

Return the result table in any order.  

The result format is in the following example.  

 

## Example 1:

### Input: 

Customer table:


| customer_id | product_key |
|-------------|-------------|
| 1           | 5           |
| 2           | 6           |
| 3           | 5           |
| 3           | 6           |
| 1           | 6           |

Product table:

| product_key |
|-------------|
| 5           |
| 6           |

### Output: 

| customer_id |
|-------------|
| 1           |
| 3           |

### Explanation: 
* The customers who bought all the products (5 and 6) are customers with IDs 1 and 3.


<br/>

---

<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>


## ğŸŸ¢ ë‹µì•ˆ (SQL Solution)

```sql
WITH TEMP AS (
    SELECT customer_id, COUNT(DISTINCT(product_key)) as bought_count
    FROM Customer C
    LEFT JOIN Product P
    USING (product_key)
    GROUP BY customer_id
)

SELECT customer_id 
FROM TEMP
WHERE bought_count = (SELECT COUNT(*) FROM Product)

```

## ğŸŸ¢ í’€ì´ (Discription)
`CTE`ë¥¼ ì‚¬ìš©í•´ `customer_id`ì˜ ìœ ë‹ˆí¬ ê°’ì„ í•„í„°ë§í•´ì„œ ë°ì´í„°ë¥¼ ì§‘ê³„í•´ í•´ê²°í–ˆìŠµë‹ˆë‹¤.   
ë¬¸ì œì—ì„œ ë‚˜ì˜¨ ì¡°ê±´ì— ë”°ë¼ì„œ, í’€ì´ë¥¼ ëŒ€ì‹ í•˜ê² ìŠµë‹ˆë‹¤. 

1. `LEFT JOIN` í›„, `customer_id`ë¡œ ì§‘ê³„í•´ì„œ, ê° `customer_id` ë³„ì˜ Product_ket ê°œìˆ˜ë¥¼ ì§‘ê³„í•©ë‹ˆë‹¤. 

```sql
WITH TEMP AS (
    SELECT customer_id, COUNT(DISTINCT(product_key)) as bought_count
    FROM Customer C
    LEFT JOIN Product P
    USING (product_key)
    GROUP BY customer_id)
```

### LEFT JOIN ê²°ê³¼ 

| customer_id | bought_count |
| ----------- | ------------ |
| 1           | 2            |
| 2           | 1            |
| 3           | 2            |...

ì´í›„ ì§‘ê³„ëœ `bought_count`ê³¼, ê¸°ì¡´ì˜ Product ì»¬ëŸ¼ì˜ ìœ ë‹ˆí¬ í•œ ê°’ì˜ ê°œìˆ˜ë¥¼ ë¹„êµí•˜ë©´ ë©ë‹ˆë‹¤.  

### ğŸŸ¢ ì¶”ê°€ ë‹µì•ˆ (SQL Solution)

```sql
SELECT customer_id
FROM Customer
GROUP BY customer_id
HAVING COUNT(DISTINCT(product_key)) IN (SELECT COUNT(*) FROM Product)
```
ë˜ ìœ„ì˜ ì¿¼ë¦¬ë¥¼ ì •ë¦¬í•˜ë‹¤ê°€, `CTE` ì—†ì´ ê·¸ëƒ¥ `IN` ì ˆì— `Subquery`ê°€ ë” íš¨ìœ¨ì ì´ê² ë„¤? ë¼ëŠ” ìƒê°ì— í’€ì–´ë´¤ëŠ”ë°  
ë³´ë‹¤ íš¨ìœ¨ì ì¸ ë‹µì´ ë‚˜ì™”ìŠµë‹ˆë‹¤. ë¡œì§ì€ ë™ì¼í•©ë‹ˆë‹¤.